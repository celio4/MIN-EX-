import { t as stubsRoot } from "../../main-kn40V-hF.js";
import stringHelpers from "../../src/helpers/string.js";
import { f as BaseCommand, l as flags, o as args } from "../../main-MBAMnmJb.js";
import { t as __decorate } from "../../decorate-DmrZA614.js";
import { extname, relative } from "node:path";
const ALLOWED_ENVIRONMENTS = [
	"web",
	"console",
	"test",
	"repl"
];
var MakeProvider = class extends BaseCommand {
	static commandName = "make:provider";
	static description = "Create a new service provider class";
	stubPath = "make/provider/main.stub";
	#isEnvironmentsFlagValid() {
		if (!this.environments || !this.environments.length) return true;
		return this.environments.every((one) => ALLOWED_ENVIRONMENTS.includes(one));
	}
	async run() {
		if (!this.#isEnvironmentsFlagValid()) {
			this.logger.error(`Invalid environment(s) "${this.environments}". Only "${ALLOWED_ENVIRONMENTS}" are allowed`);
			return;
		}
		if (this.register === void 0) this.register = await this.prompt.confirm("Do you want to register the provider in .adonisrc.ts file?");
		const codemods = await this.createCodemods();
		const { destination } = await codemods.makeUsingStub(stubsRoot, this.stubPath, {
			flags: this.parsed.flags,
			entity: this.app.generators.createEntity(this.name)
		}, { contentsFromFile: this.contentsFrom });
		if (!this.register) return;
		const providerRelativePath = stringHelpers.toUnixSlash(relative(this.app.providersPath(), destination).replace(extname(destination), ""));
		await codemods.updateRcFile((rcFile) => {
			rcFile.addProvider(`#providers/${providerRelativePath}`, this.environments);
		});
	}
};
__decorate([args.string({ description: "Name of the provider" })], MakeProvider.prototype, "name", void 0);
__decorate([flags.boolean({
	description: "Auto register the provider inside the .adonisrc.ts file",
	showNegatedVariantInHelp: true,
	alias: "r"
})], MakeProvider.prototype, "register", void 0);
__decorate([flags.array({
	description: `Define the provider environment. Accepted values are "${ALLOWED_ENVIRONMENTS}"`,
	alias: "e"
})], MakeProvider.prototype, "environments", void 0);
__decorate([flags.string({ description: "Use the contents of the given file as the generated output" })], MakeProvider.prototype, "contentsFrom", void 0);
export { MakeProvider as default };

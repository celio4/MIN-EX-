import { n as importTypeScript, t as importAssembler } from "../utils-rRkbAPnP.js";
import { f as BaseCommand, l as flags } from "../main-MBAMnmJb.js";
import { t as __decorate } from "../decorate-DmrZA614.js";
var Build = class extends BaseCommand {
	static commandName = "build";
	static description = "Build application for production by compiling frontend assets and TypeScript source to JavaScript";
	static help = [
		"Create the production build using the following command.",
		"```",
		"{{ binaryName }} build",
		"```",
		"",
		"The assets bundler dev server runs automatically after detecting vite config or webpack config files",
		"You may pass vite CLI args using the --assets-args command line flag.",
		"```",
		"{{ binaryName }} build --assets-args=\"--debug --base=/public\"",
		"```"
	];
	#logMissingDevelopmentDependency(dependency) {
		this.logger.error([
			`Cannot find package "${dependency}"`,
			"",
			`The "${dependency}" package is a development dependency and therefore you should use the build command with development dependencies installed.`,
			"",
			"If you are using the build command inside a CI or with a deployment platform, make sure the NODE_ENV is set to \"development\""
		].join("\n"));
	}
	async run() {
		const assembler = await importAssembler(this.app);
		if (!assembler) {
			this.#logMissingDevelopmentDependency("@adonisjs/assembler");
			this.exitCode = 1;
			return;
		}
		const ts = await importTypeScript(this.app);
		if (!ts) {
			this.#logMissingDevelopmentDependency("typescript");
			this.exitCode = 1;
			return;
		}
		const bundler = new assembler.Bundler(this.app.appRoot, ts, {
			metaFiles: this.app.rcFile.metaFiles,
			hooks: this.app.rcFile.hooks
		});
		bundler.ui.logger = this.logger;
		const stopOnError = this.ignoreTsErrors === true ? false : true;
		if (!await bundler.bundle(stopOnError, this.packageManager)) this.exitCode = 1;
	}
};
__decorate([flags.boolean({ description: "Ignore TypeScript errors and continue with the build process" })], Build.prototype, "ignoreTsErrors", void 0);
__decorate([flags.string({ description: "Define the package manager to copy the appropriate lock file" })], Build.prototype, "packageManager", void 0);
export { Build as default };
